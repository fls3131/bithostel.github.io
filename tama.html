<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tux Pro - Mega Historiador Sincronizado</title>
    <style>
        :root {
            --danger: #e74c3c;
            --success: #2ecc71;
            --primary: #2980b9;
            --higiene: #3498db;
            --energia: #f1c40f;
            --bg-dark: #1a252f;
        }
        body { 
            font-family: 'Segoe UI', sans-serif; 
            display: flex; justify-content: center; align-items: center; 
            height: 100vh; background: var(--bg-dark); margin: 0; overflow: hidden; 
        }
        .game-card { 
            background: #ecf0f1; padding: 35px; border-radius: 40px; 
            box-shadow: 0 30px 60px rgba(0,0,0,0.5); text-align: center; 
            width: 580px; position: relative; transform: scale(0.8); transform-origin: center; 
        }
        .idade-badge { 
            position: absolute; top: 25px; left: 25px; background: var(--primary); 
            color: white; padding: 8px 18px; border-radius: 20px; font-size: 0.9rem; font-weight: bold; z-index: 11; 
        }
        .fatos-badge { 
            position: absolute; top: 25px; right: 25px; background: #8e44ad; 
            color: white; padding: 8px 18px; border-radius: 20px; font-size: 0.9rem; font-weight: bold; z-index: 11; 
        }
        .ciclo-container { width: 100%; height: 10px; background: #bdc3c7; border-radius: 5px; margin: 15px 0; overflow: hidden; }
        #ciclo-bar { width: 100%; height: 100%; background: var(--primary); transition: width 0.1s linear; }
        
        .speech-bubble { 
            position: absolute; top: -100px; left: 50%; transform: translateX(-50%); 
            background: white; border-radius: 20px; padding: 18px; font-size: 0.95rem; 
            font-weight: bold; box-shadow: 0 10px 30px rgba(0,0,0,0.3); 
            width: 400px; display: none; z-index: 100; border: 3px solid var(--primary); color: #2c3e50;
            line-height: 1.4;
        }

        .pet-container { height: 180px; display: flex; justify-content: center; align-items: center; position: relative; }
        .pet-display { width: 150px; height: 150px; transition: transform 0.4s; }
        .pet-display img { width: 100%; height: auto; display: block; }
        
        /* Anima√ß√µes */
        .anim-comer { animation: eating 1s ease-in-out; }
        .anim-carinho { animation: heart-beat 1.2s ease-in-out; }
        .anim-passear { animation: walking 1s infinite linear; }
        .anim-limpar { animation: cleaning 1s ease-in-out; }
        .anim-dormir { animation: sleeping 2s ease-in-out; }
        .critical { animation: pulse-red 2s infinite; }
        
        @keyframes eating { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1) rotate(5deg); } }
        @keyframes heart-beat { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        @keyframes walking { 0% { transform: translateX(0); } 25% { transform: translateX(15px); } 75% { transform: translateX(-15px); } 100% { transform: translateX(0); } }
        @keyframes cleaning { 0% { transform: rotate(0); } 50% { transform: rotate(15deg); } 100% { transform: rotate(0); } }
        @keyframes sleeping { 0%, 100% { transform: scale(1); opacity: 1; } 50% { transform: scale(0.95); opacity: 0.8; } }
        @keyframes pulse-red { 0% { filter: drop-shadow(0 0 10px red); } 50% { filter: drop-shadow(0 0 25px red); } 100% { filter: drop-shadow(0 0 10px red); } }
        
        .particle { position: absolute; pointer-events: none; animation: float-up 2s forwards; font-size: 35px; z-index: 20; }
        @keyframes float-up { 0% { transform: translateY(0) opacity: 1; } 100% { transform: translateY(-120px) opacity: 0; } }

        .speed-control { margin: 15px 0; background: #dfe6e9; padding: 12px; border-radius: 20px; border: 1px solid #b2bec3; }
        input[type=range] { width: 100%; cursor: pointer; accent-color: var(--primary); }

        .stats { text-align: left; margin-bottom: 20px; }
        .bar-label { font-size: 0.75rem; font-weight: bold; display: block; margin-top: 5px; color: #34495e; }
        .bar-container { background: #ddd; border-radius: 12px; height: 10px; width: 100%; margin: 3px 0 7px; overflow: hidden; }
        .bar { height: 100%; transition: width 0.5s ease-in-out; }

        .actions { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        button { padding: 10px; border: none; border-radius: 12px; color: white; cursor: pointer; font-weight: bold; font-size: 0.8rem; transition: 0.2s; }
        button:active { transform: scale(0.95); }
        button:disabled { background: #bdc3c7 !important; cursor: not-allowed; opacity: 0.6; }

        .btn-alimentar { background: #e67e22; }
        .btn-verde { background: var(--success); }
        .btn-higiene { background: var(--higiene); }
        .btn-descanso { background: var(--energia); color: #333; }

        #reset-btn { background: var(--bg-dark) !important; display: none; grid-column: span 2; margin-top: 15px; font-size: 1.1rem; padding: 15px; }
        #msg { min-height: 45px; font-weight: bold; margin-top: 10px; font-size: 0.9rem; }
        .dead { filter: grayscale(1) opacity(0.5); transform: rotate(180deg) !important; transition: 2s; }
    </style>
</head>
<body>

<div class="game-card">
    <div class="idade-badge">IDADE: <span id="idade-val">0</span> dias</div>
    <div class="fatos-badge">FATOS: <span id="fatos-val">0</span></div>
    <div id="balao" class="speech-bubble">Aguardando novo ciclo...</div>
        
    <div class="pet-container" id="container">
        <div id="pet-visual" class="pet-display">
            <img src="https://upload.wikimedia.org/wikipedia/commons/a/af/Tux.png" alt="Tux">
        </div>
    </div>
        
    <div class="ciclo-container">
        <div id="ciclo-bar"></div>
    </div>

    <div class="speed-control">
        <label id="speed-title" style="font-weight: bold; display:block; font-size: 0.75rem;">VELOCIDADE DO TEMPO</label>
        <input type="range" id="speed-slider" min="0" max="4" step="1" value="0" oninput="mudarVelocidade(this.value)">
    </div>
        
    <div class="stats">
        <span class="bar-label">üêü FOME</span>
        <div class="bar-container"><div id="fome-bar" class="bar" style="background:var(--danger)"></div></div>
        <span class="bar-label">üòä FELICIDADE</span>
        <div class="bar-container"><div id="felicidade-bar" class="bar" style="background:var(--success)"></div></div>
        <span class="bar-label">üåä HIGIENE</span>
        <div class="bar-container"><div id="higiene-bar" class="bar" style="background:var(--higiene)"></div></div>
        <span class="bar-label">‚ö° ENERGIA</span>
        <div class="bar-container"><div id="energia-bar" class="bar" style="background:var(--energia)"></div></div>
    </div>

    <div class="actions">
        <button class="btn-action btn-alimentar" onclick="interagir('alimentar')">Dar Peixe</button>
        <button class="btn-action btn-verde" onclick="interagir('carinho')">Cafun√©</button>
        <button class="btn-action btn-verde" onclick="interagir('passear')">Escorregar</button>
        <button class="btn-action btn-descanso" onclick="interagir('descansar')">Cochilar</button>
        <button class="btn-action btn-higiene" onclick="interagir('banho')">Mergulho</button>
        <button class="btn-action btn-higiene" onclick="interagir('rosto')">Limpar Bico</button>
        <button id="reset-btn" onclick="location.reload()">REANIMAR TUX</button>
    </div>
    <div id="msg"></div>
</div>

<script>
    let fome = 20, felicidade = 80, higiene = 100, energia = 100, idade = 0, fatosLidos = 0;
    let vivo = true, nomePet = "Tux";
    let gameLoop, visualLoop, falaTimeout;
    
    // Lista de fatos (abreviada aqui, use a lista completa anterior)
    const fatosHistoricos = [
        "1969: O homem pisa na Lua pela primeira vez! üöÄ", "1906: Santos Dumont voa com o 14-Bis. ‚úàÔ∏è",
        "1945: Fim da Segunda Guerra Mundial. ‚òÆÔ∏è", "1500: Pedro √Ålvares Cabral chega ao Brasil. üáßüá∑",
        "1989: O Muro de Berlim √© derrubado. üß±", "1503: Da Vinci come√ßa a pintar a Mona Lisa. üé®",
        "476: Queda definitiva do Imp√©rio Romano. üèõÔ∏è", "1905: Einstein publica a Relatividade. üß†",
        "1789: In√≠cio da Revolu√ß√£o Francesa. üá´üá∑", "1969: Criada a Arpanet, precursora da web. üåê",
        "1996: Tux torna-se o mascote do Linux! üêß", "1876: Bell faz a 1¬™ liga√ß√£o telef√¥nica. üìû",
        "1929: A quebra da Bolsa de NY abala o mundo. üìâ", "1953: Estrutura do DNA √© descoberta. üß¨",
        "1912: O Titanic afunda no Atl√¢ntico Norte. üö¢", "1964: Martin Luther King recebe o Nobel. üïäÔ∏è",
        "1888: Princesa Isabel assina a Lei √Åurea. ‚õìÔ∏è", "1889: Brasil deixa de ser Imp√©rio. üëë",
        "1947: √çndia torna-se livre do Reino Unido. üáÆüá≥", "1985: Primeiro festival Rock in Rio. üé∏",
        "1822: Grito do Ipiranga: Independ√™ncia! ‚öîÔ∏è", "1994: Nelson Mandela √© eleito presidente. üáøüá¶",
        "1977: Estreia o primeiro Star Wars no cinema. üåå", "1908: Henry Ford produz o Modelo T. üöó",
        "1928: Fleming descobre a penicilina. üíä", "2004: Mark Zuckerberg lan√ßa o Facebook. üíª",
        "1957: Sputnik 1: o 1¬∫ objeto humano no espa√ßo. üì°", "1455: Gutenberg termina sua primeira B√≠blia. üìñ",
        "1990: Nelson Mandela sai da pris√£o. üîì", "1914: Come√ßa a Primeira Guerra Mundial. ‚öîÔ∏è",
        "1932: Mulheres brasileiras podem votar. üó≥Ô∏è", "1981: IBM lan√ßa seu computador pessoal (PC). üñ•Ô∏è",
        "2007: Apple apresenta o primeiro iPhone. üì±", "1972: Pong √© lan√ßado pela Atari. üïπÔ∏è",
        "1941: Pearl Harbor √© atacada pelo Jap√£o. ‚úàÔ∏è", "1896: 1as Olimp√≠adas Modernas em Atenas. üèÖ",
        "1666: Newton observa a decomposi√ß√£o da luz. üçé", "1939: Invas√£o da Pol√¥nia inicia a 2¬™ Guerra. üí•",
        "1997: IA Deep Blue vence campe√£o de xadrez. ‚ôüÔ∏è", "1962: Crise dos M√≠sseis quase gera guerra. ‚ò¢Ô∏è",
        "1986: Acidente nuclear em Chernobyl. ‚ò£Ô∏è", "1955: Rosa Parks desafia segrega√ß√£o em √¥nibus. üöå",
        "1961: Yuri Gagarin diz: 'A Terra √© azul'. üë®‚ÄçüöÄ", "1901: Institu√≠do o Pr√™mio Nobel. üèÜ",
        "1808: A Corte Portuguesa foge para o Brasil. üö¢", "1948: ONU adota Declara√ß√£o dos Dir. Humanos. üìú",
        "1973: Motorola faz a 1¬™ chamada de celular. üìû", "1991: O fim oficial da Uni√£o Sovi√©tica. üá∑üá∫",
        "2001: Atentados do 11 de Setembro nos EUA. üóΩ", "1922: Semana de Arte Moderna abala o BR. üé®",
        "1968: Grande ano de protestos estudantis. üì¢", "1946: ENIAC: 1¬∫ computador digital. üíæ",
        "1839: Surgimento oficial da Fotografia. üì∏", "1954: Funda√ß√£o de Bras√≠lia, nova capital. üèóÔ∏è",
        "1971: Ray Tomlinson envia o 1¬∫ e-mail. üìß", "1995: Microsoft lan√ßa o Windows 95. üíø",
        "1347: A Peste Negra chega √† Europa. üêÅ", "1517: 95 teses de Lutero iniciam a Reforma. üìú",
        "1760: Revolu√ß√£o Industrial muda as f√°bricas. üè≠", "1859: Darwin lan√ßa 'A Origem das Esp√©cies'. ü¶ç",
        "1949: Funda√ß√£o da Rep√∫blica Popular da China. üá®üá≥", "1960: Bras√≠lia √© inaugurada em 21 de abril. üèôÔ∏è",
        "1992: Eco-92 debate o clima no RJ. üåé", "1984: Comercial do Mac vai ao ar no SuperBowl. üçé",
        "1903: 1¬∫ voo motorizado dos Irm√£os Wright. üõ©Ô∏è", "1519: Magalh√£es tenta circum-navega√ß√£o. ‚õµ",
        "1865: Abraham Lincoln √© assassinado. üá∫üá∏", "1950: Brasil sedia a Copa do Maracanazo. ‚öΩ",
        "1994: Plano Real entra em vigor no Brasil. üíµ", "2000: Esta√ß√£o Espacial Internacional recebe tripula√ß√£o. üõ∞Ô∏è",
        "1844: Samuel Morse envia mensagem por tel√©grafo. üìü", "1963: 'I Have a Dream' ecoa em Washington. üó£Ô∏è",
        "1924: Jogos Ol√≠mpicos de Inverno estreiam. ‚ùÑÔ∏è", "1998: Larry Page e Sergey Brin fundam o Google. üîç",
        "1943: Anne Frank recebe seu di√°rio de presente. üìï", "1911: Machu Picchu √© 'redescoberta'. ‚õ∞Ô∏è",
        "2009: Bitcoin √© lan√ßado por Satoshi Nakamoto. ‚Çø", "1895: 1¬™ sess√£o de cinema dos Irm√£os Lumi√®re. üìΩÔ∏è",
        "1215: Assinatura da Magna Carta na Inglaterra. üìú", "1920: Funda√ß√£o da Sociedade das Na√ß√µes. üè≥Ô∏è",
        "1958: Pel√© ganha sua 1¬™ Copa aos 17 anos. ‚öΩ", "1975: Bill Gates e Paul Allen fundam a Microsoft. üíª",
        "1990: Lan√ßamento do Telesc√≥pio Hubble. üî≠", "2012: O B√≥son de Higgs √© confirmado no CERN. ‚öõÔ∏è",
        "1900: Exposi√ß√£o Universal de Paris. üóº", "1755: Grande terremoto destr√≥i Lisboa. üèöÔ∏è",
        "1940: Inven√ß√£o do radar moderno. üì°", "1815: Napole√£o Bonaparte perde em Waterloo. ‚öîÔ∏è",
        "1980: Morte de John Lennon em Nova York. üé∏", "2008: Elei√ß√£o de Barack Obama nos EUA. üá∫üá∏",
        "1930: Uruguai sedia e ganha a 1¬™ Copa. üèÜ", "1967: 1¬∫ transplante de cora√ß√£o humano. ü´Ä",
        "1927: 1¬∫ filme com som: O Cantor de Jazz. üé¨", "1999: O Euro torna-se moeda oficial. üí∂",
        "1898: Madame Curie descobre o r√°dio. üß™", "1959: Revolu√ß√£o Cubana toma Havana. üá®üá∫",
        "1982: Lan√ßamento do CD (Compact Disc). üíø", "1976: Steve Jobs funda a Apple na garagem. üçé",
        "1706: Benjamin Franklin nasce em Boston. ‚ö°", "1917: Revolu√ß√£o Russa muda o mundo. üö©",
        "1879: Edison patenteia a l√¢mpada el√©trica. üí°", "1942: Lan√ßado o filme Casablanca. üéûÔ∏è",
        "1952: Elizabeth II assume o trono brit√¢nico. üëë", "1993: Fim do Apartheid oficial na √Åfrica do Sul. üáøüá¶",
        "1837: In√≠cio da Era Vitoriana. üé©", "1966: Lan√ßamento da s√©rie Star Trek. üññ",
        "1970: Fim dos Beatles √© anunciado. üé∂", "1988: Constitui√ß√£o Brasileira √© promulgada. üìñ",
        "1492: Colombo chega √† Am√©rica. ‚õµ", "1910: Funda√ß√£o da Rep√∫blica Portuguesa. üáµüáπ",
        "1921: Descoberta da Insulina. üíâ", "1944: Dia D: Invas√£o da Normandia. üéñÔ∏è",
        "1956: JK promete '50 anos em 5'. üõ£Ô∏è", "1987: Assinado o Protocolo de Montreal. ‚ùÑÔ∏è",
        "1992: Lan√ßamento do SMS (mensagem de texto). üì±", "2005: YouTube √© fundado por 3 amigos. üìπ",
        "1869: Inaugura√ß√£o do Canal de Suez. üåä", "1904: Lan√ßamento do sorvete de casquinha. üç¶",
        "1923: Letreio de Hollywood √© erguido. üé¨", "1951: Lan√ßamento da TV Tupi no Brasil. üì∫",
        "1983: Internet adota protocolo TCP/IP. üíª", "2015: Acordo de Paris sobre o clima. üåç",
        "1891: Inven√ß√£o do Basquete por Naismith. üèÄ", "1915: Teoria da Relatividade Geral conclu√≠da. üåå",
        "1926: 1¬™ demonstra√ß√£o p√∫blica da Televis√£o. üì∫", "1949: Cria√ß√£o da OTAN. üõ°Ô∏è",
        "1965: 1¬™ caminhada espacial americana. üë©‚ÄçüöÄ", "1978: Nascimento do 1¬∫ beb√™ de proveta. üë∂",
        "1981: Descoberta do v√≠rus HIV. üî¨", "1996: Ovelha Dolly √© o 1¬∫ clone mam√≠fero. üêë",
        "2001: Lan√ßamento da Wikipedia. üìö", "1804: Napole√£o torna-se Imperador. ‚öîÔ∏è",
        "1848: Manifesto Comunista √© publicado. üìï", "1919: Assinatura do Tratado de Versalhes. üìú",
        "1925: Exibi√ß√£o do filme O Coura√ßado Potemkin. üìΩÔ∏è", "1954: Cria√ß√£o da Organiza√ß√£o do Tratado do Atl√¢ntico Norte. üó∫Ô∏è",
        "1969: Festival de Woodstock atrai multid√µes. üé∏", "1974: Revolu√ß√£o dos Cravos em Portugal. üå∏",
        "1985: Super Mario Bros √© lan√ßado pela Nintendo. üçÑ", "1997: Protocolo de Quioto √© assinado. üå°Ô∏è",
        "2006: Plut√£o deixa de ser planeta. ü™ê", "1812: Invas√£o da R√∫ssia por Napole√£o. ‚ùÑÔ∏è",
        "1861: In√≠cio da Guerra Civil Americana. üá∫üá∏", "1916: Batalha de Verdun (1¬™ Guerra). ‚öîÔ∏è",
        "1931: Inaugura√ß√£o do Cristo Redentor. ‚õ∞Ô∏è", "1945: Bombas em Hiroshima e Nagasaki. ‚ò¢Ô∏è",
        "1963: Assassinato de JFK em Dallas. üöò", "1979: Margaret Thatcher assume no Reino Unido. üá¨üáß",
        "1984: Diretas J√°: povo nas ruas do Brasil. üì¢", "1994: Netscape, 1¬∫ grande navegador web. üåê",
        "2003: In√≠cio da Guerra do Iraque. ‚öîÔ∏è", "1883: Vulc√£o Krakatoa explode na Indon√©sia. üåã",
        "1912: Descoberta do busto de Nefertiti. üè∫", "1928: Mickey Mouse estreia em 'Steamboat Willie'. üê≠",
        "1950: Come√ßa a Guerra da Coreia. üá∞üá∑", "1968: Assassinato de Martin Luther King Jr. üïäÔ∏è",
        "1972: Esc√¢ndalo de Watergate nos EUA. üïµÔ∏è", "1987: Black Monday: crash nas bolsas mundiais. üìâ",
        "1999: Popula√ß√£o mundial atinge 6 bilh√µes. üë•", "2011: Morte de Steve Jobs. üçé",
        "1799: Descoberta da Pedra de Roseta. üìú", "1850: Eus√©bio de Queir√≥s pro√≠be tr√°fico negreiro. ‚õìÔ∏è",
        "1911: Roald Amundsen chega ao Polo Sul. ‚ùÑÔ∏è", "1927: Lindbergh atravessa o Atl√¢ntico sozinho. ‚úàÔ∏è",
        "1948: Inven√ß√£o do Transistor (eletr√¥nica). üîå", "1960: Lan√ßamento da p√≠lula anticoncepcional. üíä",
        "1977: Lan√ßamento das sondas Voyager. üõ∞Ô∏è", "1989: Tiananmen: protestos na China. üá®üá≥",
        "1998: Fran√ßa vence sua 1¬™ Copa em casa. ‚öΩ", "2014: Alemanha faz 7x1 no Brasil. üá©üá™",
        "1874: 1¬™ exposi√ß√£o impressionista em Paris. üé®", "1918: Fim da Gripe Espanhola. üò∑",
        "1933: Hitler torna-se Chanceler na Alemanha. üö©", "1947: Plano Marshall ajuda reconstruir Europa. üèóÔ∏è",
        "1961: Constru√ß√£o do Muro de Berlim. üß±", "1970: Brasil conquista o Tricampeonato no M√©xico. üèÜ",
        "1980: Erradica√ß√£o mundial da Var√≠ola. üíâ", "1991: Cria√ß√£o da World Wide Web (WWW). üåê",
        "2002: Lan√ßamento do Euro como papel moeda. üí∂", "2016: Rio de Janeiro sedia as Olimp√≠adas. üèÖ",
        "1807: Inven√ß√£o do Barco a Vapor. üö¢", "1897: Funda√ß√£o de Belo Horizonte (MG). üèôÔ∏è",
        "1922: Descoberta da tumba de Tutanc√¢mon. ‚ö∞Ô∏è", "1940: Winston Churchill torna-se Primeiro-Ministro. üá¨üáß",
        "1957: Funda√ß√£o da Comunidade Europeia. üá™üá∫", "1964: Golpe Militar no Brasil. üáßüá∑",
        "1975: Fim da Guerra do Vietn√£. üöÅ", "1983: Lan√ßamento do Microsoft Word. üìù",
        "1995: Assassinato de Yitzhak Rabin. üïäÔ∏è", "2008: Grande crise financeira global. üìâ",
        "1776: Declara√ß√£o de Independ√™ncia dos EUA. üá∫üá∏", "1885: Vacina contra a Raiva por Pasteur. üêï",
        "1924: Morte de L√™nin na URSS. üö©", "1946: 1¬™ Assembleia Geral da ONU. üåè",
        "1959: Lan√ßamento da boneca Barbie. üë±‚Äç‚ôÄÔ∏è", "1967: 'O Ver√£o do Amor' em San Francisco. üå∏",
        "1976: Concorde inicia voos comerciais. ‚úàÔ∏è", "1990: Lan√ßamento do Game Boy na Europa. üéÆ",
        "1997: Morte da Princesa Diana em Paris. üëë", "2000: Google lan√ßa o servi√ßo AdWords. üí∞",
        "1824: 9¬™ Sinfonia de Beethoven estreia. üéº", "1863: Aboli√ß√£o da escravid√£o nos EUA. ‚õìÔ∏è",
        "1913: Henry Ford cria a Linha de Montagem. üè≠", "1936: Guerra Civil Espanhola come√ßa. üá™üá∏",
        "1953: 1¬™ ascens√£o ao topo do Everest. üèîÔ∏è", "1965: Bob Dylan 'fica el√©trico' em Newport. üé∏",
        "1981: Casamento de Charles e Diana. üíç", "1993: Tratado de Maastricht cria a UE. üá™üá∫",
        "2004: Tsunami no Oceano √çndico. üåä", "2018: Descoberta de √°gua l√≠quida em Marte. ü™ê"
    ];

    const tempos = [20000, 30000, 40000, 50000, 60000];
    let tempoAtual = tempos[0];
    let tempoRestante = tempoAtual;
    
    const elPet = document.getElementById('pet-visual');
    const elBalao = document.getElementById('balao');
    const elCicloBar = document.getElementById('ciclo-bar');

    function mudarVelocidade(index) {
        tempoAtual = tempos[index];
        tempoRestante = tempoAtual;
        document.getElementById('speed-title').innerText = "VELOCIDADE DO TEMPO: N√çVEL " + (parseInt(index)+1);
        if (vivo) iniciarLoops();
    }

    function falar(texto, tempo) {
        if (!vivo) return;
        elBalao.innerText = texto;
        elBalao.style.display = 'block';
        
        if (falaTimeout) clearTimeout(falaTimeout);
        
        falaTimeout = setTimeout(() => { 
            if(vivo) elBalao.style.display = 'none'; 
        }, tempo - 100); 
    }

    function iniciarLoops() {
        clearInterval(gameLoop);
        clearInterval(visualLoop);
        
        // Primeiro fato imediato ao iniciar
        fatosLidos++;
        document.getElementById('fatos-val').innerText = fatosLidos;
        const fatoInicial = fatosHistoricos[Math.floor(Math.random() * fatosHistoricos.length)];
        falar(fatoInicial, tempoAtual);

        gameLoop = setInterval(() => {
            if (vivo) {
                idade++;
                fome = Math.min(100, fome + 12);
                felicidade = Math.max(0, felicidade - 10);
                higiene = Math.max(0, higiene - 8);
                energia = Math.max(0, energia - 10);
                tempoRestante = tempoAtual;

                fatosLidos++;
                document.getElementById('fatos-val').innerText = fatosLidos;
                const fatoAleatorio = fatosHistoricos[Math.floor(Math.random() * fatosHistoricos.length)];
                falar(fatoAleatorio, tempoAtual); 

                verificarMorte();
                atualizarInterface();
                elCicloBar.style.backgroundColor = "white";
                setTimeout(() => elCicloBar.style.backgroundColor = "var(--primary)", 100);
            }
        }, tempoAtual);

        visualLoop = setInterval(() => {
            if (vivo) {
                tempoRestante -= 100;
                elCicloBar.style.width = Math.max(0, (tempoRestante / tempoAtual) * 100) + "%";
            }
        }, 100);
    }

    function verificarMorte() {
        if (fome >= 100 || felicidade <= 0 || higiene <= 0 || energia <= 0) {
            vivo = false;
            finalizarJogo();
        }
    }

    function criarParticula(emoji) {
        const p = document.createElement('div');
        p.className = 'particle';
        p.innerText = emoji;
        p.style.left = (Math.random() * 60 + 20) + '%';
        document.getElementById('container').appendChild(p);
        setTimeout(() => p.remove(), 2000);
    }

    function atualizarInterface() {
        fome = Math.max(0, Math.min(100, fome));
        felicidade = Math.max(0, Math.min(100, felicidade));
        higiene = Math.max(0, Math.min(100, higiene));
        energia = Math.max(0, Math.min(100, energia));

        document.getElementById('fome-bar').style.width = fome + "%";
        document.getElementById('felicidade-bar').style.width = felicidade + "%";
        document.getElementById('higiene-bar').style.width = higiene + "%";
        document.getElementById('energia-bar').style.width = energia + "%";
        document.getElementById('idade-val').innerText = idade;
        
        const elMsg = document.getElementById('msg');
        if (vivo) {
            if (fome >= 75 || felicidade <= 30 || higiene <= 30 || energia <= 30) {
                elPet.classList.add('critical');
                elMsg.innerHTML = `<span style="color: var(--danger)">Situa√ß√£o Cr√≠tica!</span>`;
            } else {
                elPet.classList.remove('critical');
                elMsg.innerHTML = `<span style="color: var(--success)">Aprenda com ${nomePet}! üìö</span>`;
            }
        }
    }

    function finalizarJogo() {
        clearInterval(gameLoop);
        clearInterval(visualLoop);
        elPet.classList.add('dead');
        elBalao.style.display = 'none';
        elCicloBar.style.width = "0%";
        document.getElementById('msg').innerHTML = `
            <div style="color: var(--danger); font-size: 1.2rem; font-weight: bold;">FIM DA JORNADA</div>
            <div style="font-size: 0.8rem;">${nomePet} partiu ap√≥s ${idade} dias e ensinou ${fatosLidos} li√ß√µes.</div>
        `;
        document.querySelectorAll('.btn-action').forEach(b => b.disabled = true);
        document.getElementById('speed-slider').disabled = true;
        document.getElementById('reset-btn').style.display = 'block';
    }

    function interagir(tipo) {
        if (!vivo) return;
        elPet.classList.remove('anim-comer', 'anim-carinho', 'anim-passear', 'anim-limpar', 'anim-dormir');
        void elPet.offsetWidth; 

        switch(tipo) {
            case 'alimentar':
                fome -= 35; higiene -= 15; energia += 5;
                elPet.classList.add('anim-comer');
                criarParticula('üêü');
                break;
            case 'carinho':
                felicidade += 20; fome += 5;
                elPet.classList.add('anim-carinho');
                criarParticula('üíô');
                break;
            case 'passear':
                felicidade += 30; energia -= 35; higiene -= 15;
                elPet.classList.add('anim-passear');
                break;
            case 'descansar':
                energia += 60; fome += 25; felicidade -= 15;
                elPet.classList.add('anim-dormir');
                criarParticula('üí§');
                break;
            case 'banho':
                higiene = 100; felicidade -= 10; energia -= 10;
                elPet.classList.add('anim-limpar');
                criarParticula('üåä');
                break;
            case 'rosto':
                higiene += 25;
                elPet.classList.add('anim-limpar');
                criarParticula('üí¶');
                break;
        }
        verificarMorte();
        atualizarInterface();
    }

    window.onload = () => {
        let n = prompt("Nome do seu Pinguim Historiador:", "Tux");
        if(n) nomePet = n;
        atualizarInterface();
        iniciarLoops();
    };
</script>
</body>
</html>
