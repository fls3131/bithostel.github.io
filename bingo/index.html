<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Bingo Arena Mobile</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        :root { 
            --primary: #e94560; --bg: #1a1a2e; --card-bg: #16213e; 
            --win: #2ecc71; --accent: #f1c40f; --gold: #ffd700; 
            --money: #27ae60; --loss: #ff4757; 
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            font-family: 'Segoe UI', sans-serif; 
            background: var(--bg); 
            color: white; 
            margin: 0; 
            /* Detecta o final real da tela em todos os celulares */
            height: 100vh;
            height: 100dvh; 
            display: flex; 
            flex-direction: column; 
            overflow: hidden; 
        }

        /* Estilos para o Ranking Retr√°til */
        .ranking-container {
            transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
            max-height: 200px; 
        }

        .ranking-collapsed {
            max-height: 0px !important;
        }

        .ranking-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0,0,0,0.2);
            padding: 8px 15px;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
        }

        #toggle-ranking-btn {
            background: var(--primary);
            padding: 4px 10px;
            font-size: 0.6rem;
            height: auto;
        }

        /* Modais */
        #auth-overlay, #withdraw-modal, #deposit-modal { 
            position: fixed; top:0; left:0; width: 100%; height: 100%; 
            background: rgba(26, 26, 46, 0.98); z-index: 9999; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            padding: 20px;
        }
        #withdraw-modal, #deposit-modal { display: none; background: rgba(0,0,0,0.9); }
        .auth-card { 
            background: var(--card-bg); padding: 25px; border-radius: 12px; 
            border: 2px solid var(--primary); text-align: center; width: 100%; max-width: 400px; 
        }

        /* Layout Mobile */
        .main-layout { 
            display: flex; 
            flex-direction: column; 
            height: 100vh;
            height: 100dvh; 
        }

        /* Painel Superior: Status e Sorteio */
        .top-panel { 
            background: var(--card-bg); 
            padding: 10px; 
            border-bottom: 2px solid var(--primary); 
            flex-shrink: 0;
            z-index: 10;
        }

        .header-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 10px;
        }

        .money-display { 
            background: rgba(39, 174, 96, 0.15); 
            border: 1px solid var(--money); 
            border-radius: 8px; padding: 10px; text-align: center; 
        }
        .money-value { font-size: 1.3rem; font-weight: 900; color: #fff; }

        .ball-display {
            background: #0f3460;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid var(--accent);
        }
        #ball { font-size: 2.5rem; color: var(--accent); font-weight: 900; }

        .btn-group-main { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 8px; 
        }

        /* Arena Central: Scroll das Cartelas */
        .arena { 
            flex-grow: 1; 
            overflow-y: auto; 
            padding: 15px 10px; 
            display: flex; 
            flex-direction: column; 
            gap: 20px; 
            align-items: center;
            background: rgba(0,0,0,0.2);
        }

        .bingo-card { 
            background: var(--card-bg); 
            padding: 10px; 
            border-radius: 12px; 
            border: 1px solid #333; 
            width: 100%; 
            max-width: 380px; 
        }
        .bingo-card.player { border: 2px solid var(--primary); box-shadow: 0 0 15px rgba(233,69,96,0.3); }

        .grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 4px; }
        .cell { 
            aspect-ratio: 1/1; display: flex; align-items: center; justify-content: center; 
            background: #0f3460; border-radius: 6px; font-size: 1.1rem; font-weight: bold; 
        }
        .cell.marked { background: var(--primary); }
        .cell.line-win { background-color: var(--win) !important; color: #ffffff !important; box-shadow: 0 0 10px var(--win); transform: scale(1.05); transition: 0.3s; }
        .cell.free { background: #533483; color: var(--accent); }

        /* Painel Inferior: Fixado no fundo real */
        .bottom-panel { 
            background: var(--card-bg); 
            padding: 10px 10px; 
            border-top: 2px solid #333; 
            flex-shrink: 0;
            /* O "dobro" de altura para subir os bot√µes e fugir da barra do sistema */
            padding-bottom: calc(40px + env(safe-area-inset-bottom));
            z-index: 100;
        }

        .action-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-top: 10px;
        }

        button { 
            padding: 12px; border: none; border-radius: 8px; 
            font-weight: bold; cursor: pointer; font-size: 0.85rem; color: white; 
        }
        .btn-manual { background: var(--primary); height: 50px; }
        .btn-auto { background: #3498db; height: 50px; }
        .btn-reset { background: #533483; grid-column: span 2; height: 50px; }
        .btn-util { background: #444; font-size: 0.7rem; }

        .leader-item { display: flex; justify-content: space-between; padding: 8px; border-bottom: 1px solid #0f3460; font-size: 0.85rem; }
        .leader-item.me { background: var(--accent); color: var(--bg); font-weight: 900; border-radius: 4px; }

        #history-grid { display: flex; gap: 5px; overflow-x: auto; padding: 5px; background: #0f3460; border-radius: 4px; margin-top: 8px; }
        .hist-ball { min-width: 30px; height: 30px; background: rgba(255,255,255,0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; }
        
        #money-toast { position: fixed; top: 20%; left: 50%; transform: translate(-50%, -50%); z-index: 30000; font-size: 2rem; font-weight: 900; pointer-events: none; opacity: 0; transition: 0.4s; text-align: center; width: 100%; text-shadow: 2px 2px 10px rgba(0,0,0,0.5); }
        .toast-show { opacity: 1 !important; transform: translate(-50%, -40%) scale(1.1) !important; }
    </style>
</head>
<body>
    <div id="money-toast"></div>

    <div id="deposit-modal">
        <div class="auth-card" style="border-color: #3498db;">
            <h2 style="color: #3498db; margin: 0 0 15px 0;">DEPOSITAR PIX</h2>
            <div style="display: grid; grid-template-columns: 1fr; gap: 10px; margin-bottom: 15px;">
                <button id="dep-10" style="background:#3498db">R$ 10,00</button>
                <button id="dep-50" style="background:#3498db">R$ 50,00</button>
                <button id="dep-100" style="background:#3498db">R$ 100,00</button>
            </div>
            <button id="close-dep" style="background: #555; width: 100%;">VOLTAR</button>
        </div>
    </div>

    <div id="withdraw-modal">
        <div class="auth-card">
            <h2 style="color: var(--win); margin: 0 0 10px 0;">SAQUE PIX</h2>
            <p id="wd-balance">R$ 0,00</p>
            <input type="text" id="pix-key" placeholder="Chave Pix" style="width:100%; padding:12px; margin:5px 0; border-radius:8px; border:none;">
            <input type="number" id="withdraw-amount" placeholder="Valor M√≠n: 20" style="width:100%; padding:12px; margin:5px 0; border-radius:8px; border:none;">
            <div style="display: flex; gap: 10px; margin-top: 10px;">
                <button id="close-wd" style="background: #555; flex: 1;">VOLTAR</button>
                <button id="confirm-wd" style="background: var(--money); flex: 1;">SACAR</button>
            </div>
        </div>
    </div>

    <div id="auth-overlay">
        <div class="auth-card">
            <h2 id="auth-title">ACESSO</h2>
            <p id="auth-instruction">Crie seu PIN de 4 d√≠gitos</p>
            <input type="password" id="pass-input" maxlength="4" inputmode="numeric" style="letter-spacing:15px; font-size:2rem; width:100%; text-align:center; padding:10px; margin:15px 0; border-radius:8px;">
            <button id="btn-unlock" style="background: var(--primary); width: 100%; font-size: 1.2rem;">ENTRAR</button>
        </div>
    </div>

    <div class="main-layout">
        <div class="top-panel">
            <div class="header-grid">
                <div class="money-display">
                    <div style="font-size:0.6rem; color:var(--accent)">MEU SALDO</div>
                    <div class="money-value" id="balance">R$ 0,00</div>
                </div>
                <div class="ball-display">
                    <span id="ball">--</span>
                </div>
            </div>
            <div class="btn-group-main">
                <button id="draw-btn" class="btn-manual">SORTEAR</button>
                <button id="auto-btn" class="btn-auto">INICIAR</button>
                <button id="new-round-btn" class="btn-reset">NOVA RODADA (R$ 5,00)</button>
            </div>
            <div id="history-grid"></div>
        </div>

        <div class="arena" id="arena"></div>

        <div class="bottom-panel">
            <div class="ranking-header" id="header-ranking">
                <h4 style="margin: 0; color: var(--accent); font-size: 0.8rem;">RANKING AO VIVO</h4>
                <button id="toggle-ranking-btn">ESCONDER</button>
            </div>

            <div id="ranking-body" class="ranking-container">
                <div id="leader-list"></div>
            </div>
            
            <div class="action-grid">
                <button id="open-dep" class="btn-util" style="background: #3498db;">DEPOSITAR üí∏</button>
                <button id="open-wd" class="btn-util" style="background: var(--money);">SACAR üí∏</button>
                <button id="manual-btn" class="btn-util">AJUDA ‚ùì</button>
                <button id="btn-logout" class="btn-util" style="background: #333;">BLOQUEAR üîí</button>
            </div>
        </div>
    </div>

<script>
/* Toda a l√≥gica original permanece intacta aqui */
(function() {
    const somSorteio = new Audio('sorteio.mp3');
    const somDinheiro = new Audio('dinheiro.mp3');
    const somMarca = new Audio('marca.mp3');
    const somBingo = new Audio('bingo.mp3');
    const somLinha = new Audio('linha.mp3');
    const somGeral = new Audio('geral.mp3');

    let drawn = [], players = [], firstLineOut = false, gameOver = false, autoInterval = null;
    let totalBalance = 0;
    let costDeducted = false;
    const ROUND_COST = 5.00, LINE_PRIZE = 10.00, BINGO_PRIZE = 20.00;
    const nomesComuns = ["JO√ÉO", "MARIA", "PEDRO", "ANA", "LUCAS", "CARLA", "BRUNO", "JULIA", "MARCOS", "BEATRIZ"];

    const savedPass = localStorage.getItem('bingo_vault_pass');
    if(savedPass) {
        document.getElementById('auth-title').innerText = "BLOQUEADO";
        document.getElementById('auth-instruction').innerText = "Insira seu PIN";
    }

    function showToast(text, color) {
        const toast = document.getElementById('money-toast');
        toast.innerText = text; toast.style.color = color;
        toast.classList.add('toast-show');
        setTimeout(() => toast.classList.remove('toast-show'), 5000);
    }

    function updateBalanceDisplay() {
        document.getElementById('balance').innerText = `R$ ${totalBalance.toFixed(2).replace('.', ',')}`;
        localStorage.setItem('bingo_arena_balance', totalBalance.toString());
    }

    function processPayment() {
        if (!costDeducted && !gameOver) {
            if (totalBalance < ROUND_COST) { alert("Saldo insuficiente!"); return false; }
            totalBalance -= ROUND_COST;
            costDeducted = true;
            updateBalanceDisplay();
            showToast(`-R$ 5,00`, "#ffffff");
            return true;
        }
        return true;
    }

    function drawBall() {
        if(gameOver || drawn.length >= 75) return;
        somSorteio.currentTime = 0; somSorteio.play().catch(()=>{});
        let b; do { b = Math.floor(Math.random() * 75) + 1; } while(drawn.includes(b));
        drawn.push(b);
        document.getElementById('ball').innerText = b;
        
        let h = document.createElement('div'); h.className = "hist-ball";
        h.innerText = b; document.getElementById('history-grid').prepend(h);
        document.querySelectorAll(`[data-num="${b}"]`).forEach(c => c.classList.add('marked'));

        players.forEach(p => { 
            if(p.nums.includes(b)) {
                p.marks++; 
                if(p.id === 1) { somMarca.currentTime = 0; somMarca.play().catch(() => {}); }
            }
        });

        let sorted = [...players].sort((a,b) => b.marks - a.marks);
        let list = document.getElementById('leader-list'); list.innerHTML = "";
        sorted.slice(0, 5).forEach(p => list.innerHTML += `<div class="leader-item ${p.id===1?'me':''}"><span>${p.name}</span><span>${p.marks}/25</span></div>`);

        players.forEach(p => {
            if(!firstLineOut) {
                for(let r=0; r<5; r++) {
                    let win = true;
                    let lineCells = [];
                    for(let c=0; c<5; c++) { 
                        let cell = document.getElementById(`p${p.id}-c${r*5+c}`);
                        lineCells.push(cell);
                        if(!cell.classList.contains('marked')) win = false;
                    }
                    if(win) {
                        firstLineOut = true; 
                        somLinha.play().catch(() => {});
                        lineCells.forEach(cell => cell.classList.add('line-win'));
                        confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });

                        if(p.id === 1) { 
                            totalBalance += LINE_PRIZE; 
                            updateBalanceDisplay(); 
                            somDinheiro.play().catch(()=>{});
                            showToast(`LINHA: VOC√ä! +R$ 10,00`, "#ffffff");
                        } else {
                            showToast(`LINHA: ${p.name}!`, "#ffffff");
                        }
                    }
                }
            }
            if(p.marks === 25 && !gameOver) {
                gameOver = true; 
                if(autoInterval) { clearInterval(autoInterval); autoInterval = null; }
                if(p.id === 1) { 
                    totalBalance += BINGO_PRIZE; 
                    updateBalanceDisplay(); 
                    somDinheiro.play().catch(()=>{});
                    showToast(`BINGO! VOC√ä GANHOU R$ 20,00`, "#ffffff");
                    somBingo.play().catch(()=>{});
                } else {
                    showToast(`BINGO: ${p.name}!`, "#ffffff");
                }
                confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
            }
        });
    }

    function initGame() {
        const arena = document.getElementById('arena'); arena.innerHTML = ""; players = [];
        let nomes = [...nomesComuns].sort(() => Math.random() - 0.5);
        for(let i=1; i<=10; i++) {
            let n = []; while(n.length < 24) { let r = Math.floor(Math.random() * 75) + 1; if(!n.includes(r)) n.push(r); } n.splice(12, 0, 0);
            let p = { id: i, name: i === 1 ? "VOC√ä" : nomes[i-2], nums: n, marks: 1 };
            players.push(p);
            let card = document.createElement('div'); card.className = `bingo-card ${i===1?'player':''}`;
            card.innerHTML = `<h5 style="margin:5px 0; text-align:center;">${p.name}</h5><div class="grid" id="g-${i}"></div>`;
            arena.appendChild(card);
            p.nums.forEach((num, idx) => {
                let cell = document.createElement('div');
                cell.className = 'cell' + (num === 0 ? ' marked free' : '');
                cell.innerText = num === 0 ? '‚òÖ' : num;
                cell.id = `p${i}-c${idx}`;
                if(num !== 0) cell.setAttribute('data-num', num);
                document.getElementById(`g-${i}`).appendChild(cell);
            });
        }
    }

    document.getElementById('btn-unlock').onclick = () => {
        const input = document.getElementById('pass-input').value;
        const currentSavedPass = localStorage.getItem('bingo_vault_pass');
        if (!currentSavedPass) {
            if(input.length === 4) { localStorage.setItem('bingo_vault_pass', input); login(); }
        } else if (input === currentSavedPass) { login(); }
        else { alert("PIN incorreto"); }
    };

    function login() {
        sessionStorage.setItem('bingo_authenticated', 'true');
        document.getElementById('auth-overlay').style.display = 'none';
        totalBalance = parseFloat(localStorage.getItem('bingo_arena_balance')) || 50.00;
        updateBalanceDisplay();
        initGame();
    }

    document.getElementById('draw-btn').onclick = () => { if(processPayment()) drawBall(); };
    document.getElementById('auto-btn').onclick = function() {
        if (autoInterval) { clearInterval(autoInterval); autoInterval = null; this.innerText = "INICIAR"; }
        else if (!gameOver && processPayment()) { this.innerText = "PAUSAR"; autoInterval = setInterval(drawBall, 500); }
    };

    document.getElementById('new-round-btn').onclick = () => location.reload();
    document.getElementById('open-dep').onclick = () => document.getElementById('deposit-modal').style.display = 'flex';
    document.getElementById('close-dep').onclick = () => document.getElementById('deposit-modal').style.display = 'none';
    
    document.getElementById('dep-10').onclick = () => { totalBalance += 10; updateBalanceDisplay(); somDinheiro.play().catch(()=>{}); document.getElementById('deposit-modal').style.display = 'none'; };
    document.getElementById('dep-50').onclick = () => { totalBalance += 50; updateBalanceDisplay(); somDinheiro.play().catch(()=>{}); document.getElementById('deposit-modal').style.display = 'none'; };
    document.getElementById('dep-100').onclick = () => { totalBalance += 100; updateBalanceDisplay(); somDinheiro.play().catch(()=>{}); document.getElementById('deposit-modal').style.display = 'none'; };
    
    document.getElementById('open-wd').onclick = () => { document.getElementById('withdraw-modal').style.display = 'flex'; document.getElementById('wd-balance').innerText = `Saldo: R$ ${totalBalance}`; };
    document.getElementById('close-wd').onclick = () => document.getElementById('withdraw-modal').style.display = 'none';
    document.getElementById('btn-logout').onclick = () => { sessionStorage.removeItem('bingo_authenticated'); location.reload(); };

    if (sessionStorage.getItem('bingo_authenticated') === 'true') login();
})();

    const rankingHeader = document.getElementById('header-ranking');
    const rankingBody = document.getElementById('ranking-body');
    const toggleBtn = document.getElementById('toggle-ranking-btn');

    rankingHeader.onclick = () => {
        const isCollapsed = rankingBody.classList.toggle('ranking-collapsed');
        toggleBtn.innerText = isCollapsed ? "MOSTRAR" : "ESCONDER";
        toggleBtn.style.background = isCollapsed ? "var(--win)" : "var(--primary)";
    };
</script>
</body>
</html>
