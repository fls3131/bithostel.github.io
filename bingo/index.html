<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Bingo Arena Mobile Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        :root { 
            --primary: #e94560; --bg: #1a1a2e; --card-bg: #16213e; 
            --win: #2ecc71; --accent: #f1c40f; --gold: #ffd700; 
            --money: #27ae60; --loss: #ff4757; 
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            font-family: 'Segoe UI', sans-serif; 
            background: var(--bg); 
            color: white; 
            margin: 0; 
            height: 100vh;
            height: 100dvh; 
            display: flex; 
            flex-direction: column; 
            overflow: hidden; 
        }

        /* --- ANIMA√á√ÉO PISCAR --- */
        @keyframes flashing {
            0% { background: #533483; transform: scale(1); box-shadow: 0 0 0px var(--accent); }
            50% { background: var(--primary); transform: scale(1.05); box-shadow: 0 0 20px var(--accent); }
            100% { background: #533483; transform: scale(1); box-shadow: 0 0 0px var(--accent); }
        }
        .btn-flash {
            animation: flashing 1s infinite !important;
            border: 2px solid var(--accent) !important;
            z-index: 1001;
        }

        /* --- HIST√ìRICO --- */
        #history-modal { display: none; position: fixed; top:0; left:0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 10000; justify-content: center; align-items: center; padding: 20px; }
        .history-card { background: var(--card-bg); width: 100%; max-width: 400px; border-radius: 12px; border: 1px solid var(--accent); display: flex; flex-direction: column; max-height: 80vh; }
        .history-list { overflow-y: auto; padding: 15px; flex-grow: 1; }
        .history-item { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #0f3460; font-size: 0.85rem; }
        .hist-pos { color: var(--win); }
        .hist-neg { color: var(--loss); }

        .ranking-container {
            transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
            max-height: 200px; 
        }

        .ranking-collapsed {
            max-height: 0px !important;
        }

        .ranking-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0,0,0,0.2);
            padding: 8px 15px;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
        }

        #toggle-ranking-btn {
            background: var(--primary);
            padding: 4px 10px;
            font-size: 0.6rem;
            height: auto;
        }

        #auth-overlay, #withdraw-modal, #deposit-modal { 
            position: fixed; top:0; left:0; width: 100%; height: 100%; 
            background: rgba(26, 26, 46, 0.98); z-index: 9999; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            padding: 20px;
        }
        #withdraw-modal, #deposit-modal { display: none; background: rgba(0,0,0,0.9); }
        .auth-card { 
            background: var(--card-bg); padding: 25px; border-radius: 12px; 
            border: 2px solid var(--primary); text-align: center; width: 100%; max-width: 400px; 
        }

        .main-layout { 
            display: flex; 
            flex-direction: column; 
            height: 100vh;
            height: 100dvh; 
        }

        /* --- BARRA SUPERIOR --- */
        .top-panel { 
            background: var(--card-bg); 
            padding: 3.6px; 
            border-bottom: 2px solid var(--primary); 
            flex-shrink: 0;
            z-index: 10;
        }

        .header-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 7.2px; 
            margin-bottom: 5.4px; 
        }

        .money-display { 
            background: rgba(39, 174, 96, 0.15); 
            border: 1px solid var(--money); 
            border-radius: 8px; padding: 5.4px; 
            text-align: center; 
            cursor: pointer;
        }
        .money-value { font-size: 1rem; font-weight: 900; color: #fff; } 

        .ball-display {
            background: #0f3460;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid var(--accent);
            overflow: hidden;
            flex-direction: column;
            min-height: 60px;
        }
        #ball { font-size: 1.98rem; color: var(--accent); font-weight: 900; transition: transform 0.2s; } 
        #ball-status { font-size: 0.6rem; color: var(--win); font-weight: bold; text-transform: uppercase; }
        .ball-pop { transform: scale(1.2); }

        .btn-group-main { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 5.4px; 
        }

        .btn-manual, .btn-auto { height: 38px !important; } 
        .btn-reset { grid-column: span 2; height: 38px !important; } 

        .arena { 
            flex-grow: 1; 
            overflow-y: auto; 
            padding: 15px 10px; 
            display: flex; 
            flex-direction: column; 
            gap: 15px; 
            align-items: center;
            background: rgba(0,0,0,0.2);
        }

        /* --- CARTELAS --- */
        .bingo-card { 
            background: var(--card-bg); 
            padding: 8.5px; 
            border-radius: 12px; 
            border: 1px solid #333; 
            width: 100%; 
            max-width: 323px; 
        }
        .bingo-card.player { border: 2px solid var(--primary); box-shadow: 0 0 15px rgba(233,69,96,0.3); }

        .grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 3.4px; } 
        .cell { 
            aspect-ratio: 1 / 1; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            background: #0f3460; 
            border-radius: 5px; 
            font-size: 0.95rem; 
            font-weight: bold; 
        }
        .cell.marked { background: var(--primary); color: white; }
        .cell.line-win { background-color: var(--win) !important; color: #ffffff !important; box-shadow: 0 0 10px var(--win); transform: scale(1.05); transition: 0.3s; }
        .cell.free { background: #533483; color: var(--accent); }

        .bottom-panel { 
            background: var(--card-bg); 
            padding: 10px 10px; 
            border-top: 2px solid #333; 
            flex-shrink: 0;
            padding-bottom: calc(40px + env(safe-area-inset-bottom));
            z-index: 100;
            transition: transform 0.4s ease, max-height 0.4s ease;
            max-height: 500px;
        }

        .bottom-panel.minimized {
            transform: translateY(calc(100% - 40px - env(safe-area-inset-bottom)));
            max-height: 40px;
            overflow: hidden;
        }

        .action-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-top: 10px;
        }

        button { 
            padding: 12px; border: none; border-radius: 8px; 
            font-weight: bold; cursor: pointer; font-size: 0.85rem; color: white; 
        }
        .btn-manual { background: var(--primary); }
        .btn-auto { background: #3498db; }
        .btn-reset { background: #533483; }
        .btn-util { background: #444; font-size: 0.7rem; }

        .leader-item { display: flex; justify-content: space-between; padding: 8px; border-bottom: 1px solid #0f3460; font-size: 0.85rem; }
        .leader-item.me { background: var(--accent); color: var(--bg); font-weight: 900; border-radius: 4px; }

        #history-grid { display: flex; gap: 5px; overflow-x: auto; padding: 5px; background: #0f3460; border-radius: 4px; margin-top: 6px; min-height: 34px; }
        .hist-ball { min-width: 25px; height: 25px; background: rgba(255,255,255,0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.65rem; flex-shrink: 0; }
        
        #money-toast { 
            position: fixed; top: 30%; left: 50%; transform: translate(-50%, -50%); 
            z-index: 30000; font-size: 1.4rem; font-weight: 900; pointer-events: none; 
            opacity: 0; transition: 0.4s; text-align: center; width: 85%; 
            background: rgba(0,0,0,0.95); padding: 25px; border-radius: 15px;
            border: 2px solid var(--accent); box-shadow: 0 0 30px rgba(0,0,0,1);
        }
        .toast-show { opacity: 1 !important; transform: translate(-50%, -45%) scale(1) !important; }

        .info-box {
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 8px;
            font-size: 0.8rem;
            margin-bottom: 15px;
            text-align: left;
            border-left: 3px solid var(--accent);
        }
    </style>
</head>
<body>
    <div id="money-toast"></div>

    <div id="history-modal">
        <div class="history-card">
            <div style="padding: 15px; border-bottom: 1px solid var(--accent); display: flex; justify-content: space-between; align-items: center;">
                <h3 style="margin:0; color: var(--accent);">EXTRATO DA CARTEIRA</h3>
                <button id="close-history" style="background: #444; padding: 5px 10px;">X</button>
            </div>
            <div id="wallet-history-list" class="history-list"></div>
        </div>
    </div>

    <div id="deposit-modal">
        <div class="auth-card" style="border-color: #3498db;">
            <h2 style="color: #3498db; margin: 0 0 15px 0;">DEPOSITAR PIX</h2>
            <div style="display: grid; grid-template-columns: 1fr; gap: 10px; margin-bottom: 15px;">
                <button onclick="addFunds(10)" style="background:#3498db">R$ 10,00</button>
                <button onclick="addFunds(50)" style="background:#3498db">R$ 50,00</button>
                <button onclick="addFunds(100)" style="background:#3498db">R$ 100,00</button>
            </div>
            <button id="close-dep" style="background: #555; width: 100%;">VOLTAR</button>
        </div>
    </div>

    <div id="withdraw-modal">
        <div class="auth-card">
            <h2 style="color: var(--win); margin: 0 0 10px 0;">SAQUE PIX</h2>
            <p id="wd-balance">R$ 0,00</p>
            <input type="text" id="pix-key" placeholder="Chave Pix" style="width:100%; padding:12px; margin:5px 0; border-radius:8px; border:none;">
            <input type="number" id="withdraw-amount" placeholder="Valor M√≠n: 20" style="width:100%; padding:12px; margin:5px 0; border-radius:8px; border:none;">
            <div style="display: flex; gap: 10px; margin-top: 10px;">
                <button id="close-wd" style="background: #555; flex: 1;">VOLTAR</button>
                <button id="confirm-wd" style="background: var(--money); flex: 1;">SACAR</button>
            </div>
        </div>
    </div>

    <div id="auth-overlay">
        <div class="auth-card">
            <h2 id="auth-title" style="color: var(--primary); margin-bottom: 10px;">PRIMEIRO ACESSO</h2>
            <div id="auth-info" class="info-box">
                <strong>üîí Seguran√ßa da Conta</strong><br>
                Crie um PIN de 8 n√∫meros para proteger seu saldo.
            </div>
            <p id="auth-instruction" style="font-size: 0.9rem; margin-bottom: 10px;">Crie seu PIN de 8 d√≠gitos:</p>
            <input type="tel" id="pass-input" maxlength="8" placeholder="********" style="letter-spacing:8px; font-size:1.8rem; width:100%; text-align:center; padding:10px; margin-bottom:15px; border-radius:8px; border: 2px solid #333; background: #0f3460; color: white;">
            <button id="btn-unlock" style="background: var(--primary); width: 100%; font-size: 1.2rem; margin-bottom: 15px;">CONFIRMAR E ENTRAR</button>
        </div>
    </div>

    <div class="main-layout">
        <div class="top-panel">
            <div class="header-grid">
                <div class="money-display" id="open-history-trigger">
                    <div style="font-size:0.5rem; color:var(--accent)">MEU SALDO (CLIQUE AQUI)</div>
                    <div class="money-value" id="balance">R$ 0,00</div>
                </div>
                <div class="ball-display">
                    <span id="ball-status">SORTEANDO...</span>
                    <span id="ball">--</span>
                </div>
            </div>
            <div class="btn-group-main">
                <button id="draw-btn" class="btn-manual">Sortear Manual</button>
                <button id="auto-btn" class="btn-auto">Sortear Autom√°tico</button>
                <button id="new-round-btn" class="btn-reset">NOVA RODADA (R$ 6,00)</button>
            </div>
            <div id="history-grid"></div>
        </div>

        <div class="arena" id="arena"></div>

        <div class="bottom-panel">
            <div class="ranking-header" id="header-ranking">
                <h4 id="ranking-title-text" style="margin: 0; color: var(--accent); font-size: 0.8rem;">RANKING AO VIVO</h4>
                <button id="toggle-ranking-btn">ESCONDER</button>
            </div>
            <div id="ranking-body" class="ranking-container">
                <div id="leader-list"></div>
            </div>
            <div class="action-grid">
                <button id="open-dep" class="btn-util" style="background: #3498db;">DEPOSITAR üí∏</button>
                <button id="open-wd" class="btn-util" style="background: var(--money);">SACAR üí∏</button>
                <button id="toggle-sound" class="btn-util" style="background: #9b59b6;">SOM: ON üîä</button>
                <button id="help-btn" class="btn-util">AJUDA ‚ùì</button>
                <button id="toggle-full-panel" class="btn-util" style="background: #2c3e50;">OCULTAR MENU ‚¨áÔ∏è</button>
                <button id="btn-logout" class="btn-util" style="background: #333;">BLOQUEAR üîí</button>
            </div>
        </div>
    </div>

<script>
(function() {
    const somSorteio = new Audio('sorteio.mp3');
    const somDinheiro = new Audio('dinheiro.mp3');
    const somMarca = new Audio('marca.mp3');
    const somBingo = new Audio('bingo.mp3');
    const somLinha = new Audio('linha.mp3');

    let audioUnlocked = false;
    let drawn = [], players = [], firstLineOut = false, gameOver = false, autoInterval = null;
    let totalBalance = 0, costDeducted = false;
    let soundEnabled = localStorage.getItem('bingo_sound_enabled') !== 'false'; 
    let toastTimeout = null;

    function unlockAudio() {
        if (audioUnlocked) return;
        [somSorteio, somDinheiro, somMarca, somBingo, somLinha].forEach(audio => {
            audio.play().then(() => { audio.pause(); audio.currentTime = 0; }).catch(() => {});
        });
        audioUnlocked = true;
    }

    // --- FUN√á√ÉO DE MENSAGEM CORRIGIDA (COM FILA/PRIORIDADE) ---
    function showToast(text, color, isWinner = false) {
        const toast = document.getElementById('money-toast');
        
        // Se for um ganhador, atualiza o status na bola tamb√©m
        if(isWinner) {
            document.getElementById('ball-status').innerText = text;
            document.getElementById('ball-status').style.color = color;
        }

        // Se j√° existe um toast de ganhador na tela, n√£o deixa o de "perda de dinheiro" apagar ele
        if(toast.classList.contains('toast-show') && !isWinner && toast.isWinnerType) return;

        toast.innerText = text;
        toast.style.color = color;
        toast.isWinnerType = isWinner;
        toast.classList.add('toast-show');

        if(toastTimeout) clearTimeout(toastTimeout);
        
        // Ganhadores ficam 5 segundos, mensagens comuns 2 segundos
        toastTimeout = setTimeout(() => {
            toast.classList.remove('toast-show');
            toast.isWinnerType = false;
        }, isWinner ? 5000 : 2000);
    }

    function updateSoundButtonUI() {
        const btn = document.getElementById('toggle-sound');
        btn.innerText = soundEnabled ? "SOM: ON üîä" : "SOM: OFF üîá";
        btn.style.background = soundEnabled ? "#9b59b6" : "#666";
    }
    updateSoundButtonUI();

    let walletHistory = JSON.parse(localStorage.getItem('bingo_wallet_history') || '[]');
    const ROUND_COST = 6.00, LINE_PRIZE = 14.00, BINGO_PRIZE = 24.00;
    const nomesComuns = ["JO√ÉO", "MARIA", "PEDRO", "ANA", "LUCAS", "CARLA", "BRUNO", "JULIA", "MARCOS", "BEATRIZ"];

    const savedPass = localStorage.getItem('bingo_vault_pass');
    if(savedPass) {
        document.getElementById('auth-title').innerText = "ACESSO RESTRITO";
        document.getElementById('auth-instruction').innerText = "Insira seu PIN de 8 d√≠gitos:";
    }

    function playSound(audio) {
        if (soundEnabled) { audio.currentTime = 0; audio.play().catch(() => {}); }
    }

    function saveTransaction(desc, value) {
        walletHistory.unshift({ date: new Date().toLocaleString('pt-BR'), desc, value });
        if(walletHistory.length > 50) walletHistory.pop();
        localStorage.setItem('bingo_wallet_history', JSON.stringify(walletHistory));
    }

    function updateBalanceDisplay() {
        document.getElementById('balance').innerText = `R$ ${totalBalance.toFixed(2).replace('.', ',')}`;
        localStorage.setItem('bingo_arena_balance', totalBalance.toString());
    }

    document.getElementById('help-btn').onclick = () => {
        alert(
            "üìñ REGRAS BINGO ARENA PRO:\n\n" +
            "1. Custo: R$ 6,00 por rodada.\n" +
            "2. Linha: Ganhe R$ 14,00 (1 horizontal).\n" +
            "3. Bingo: Ganhe R$ 24,00 (cartela cheia).\n" +
            "4. Saque: M√≠nimo R$ 20,00 via PIX."
        );
    };

    function drawBall() {
        unlockAudio();
        if(gameOver || drawn.length >= 75) { if(autoInterval) stopAuto(); return; }
        
        if (!costDeducted) {
            if (totalBalance < ROUND_COST) { 
                alert("Saldo insuficiente!"); if(autoInterval) stopAuto(); return;
            }
            totalBalance -= ROUND_COST;
            saveTransaction("Entrada Rodada", -ROUND_COST);
            costDeducted = true;
            updateBalanceDisplay();
            showToast("-R$ 6,00", "#fff");
        }

        playSound(somSorteio);
        let b; do { b = Math.floor(Math.random() * 75) + 1; } while(drawn.includes(b));
        drawn.push(b);
        
        const ballEl = document.getElementById('ball');
        ballEl.innerText = b;
        ballEl.classList.remove('ball-pop');
        void ballEl.offsetWidth; ballEl.classList.add('ball-pop');

        let h = document.createElement('div'); h.className = "hist-ball";
        h.innerText = b; document.getElementById('history-grid').prepend(h);
        
        document.querySelectorAll(`[data-num="${b}"]`).forEach(c => c.classList.add('marked'));
        
        players.forEach(p => { 
            if(p.nums.includes(b)) {
                p.marks++; 
                const countEl = document.getElementById(`count-p${p.id}`);
                if(countEl) countEl.innerText = `(${p.marks}/25)`;
                if(p.id === 1) playSound(somMarca);
            }
        });
        updateRanking();
        checkWinners();
    }

    function updateRanking() {
        let sorted = [...players].sort((a,b) => b.marks - a.marks);
        let list = document.getElementById('leader-list'); list.innerHTML = "";
        sorted.slice(0, 3).forEach(p => {
            list.innerHTML += `<div class="leader-item ${p.id===1?'me':''}"><span>${p.name}</span><span>${p.marks}/25</span></div>`;
        });
    }

    function checkWinners() {
        players.forEach(p => {
            // VERIFICA√á√ÉO DE LINHA
            if(!firstLineOut) {
                for(let r=0; r<5; r++) {
                    let win = true, lineCells = [];
                    for(let c=0; c<5; c++) { 
                        let cell = document.getElementById(`p${p.id}-c${r*5+c}`);
                        lineCells.push(cell); if(!cell.classList.contains('marked')) win = false;
                    }
                    if(win) {
                        firstLineOut = true; playSound(somLinha);
                        lineCells.forEach(cell => cell.classList.add('line-win'));
                        confetti({ particleCount: 100, origin: { y: 0.6 } });
                        if(p.id === 1) { 
                            totalBalance += LINE_PRIZE; saveTransaction("Pr√™mio Linha", LINE_PRIZE);
                            updateBalanceDisplay(); 
                            showToast(`LINHA! +R$ ${LINE_PRIZE}`, "#2ecc71", true);
                        } else {
                            showToast(`LINHA: ${p.name}!`, "#ffffff", true);
                        }
                    }
                }
            }
            // VERIFICA√á√ÉO DE BINGO
            if(p.marks === 25 && !gameOver) {
                gameOver = true; stopAuto(); playSound(somBingo);
                document.getElementById('new-round-btn').classList.add('btn-flash');
                if(p.id === 1) { 
                    totalBalance += BINGO_PRIZE; saveTransaction("Pr√™mio BINGO", BINGO_PRIZE);
                    updateBalanceDisplay(); 
                    showToast(`BINGO! VOC√ä GANHOU R$ ${BINGO_PRIZE}`, "#ffd700", true);
                } else {
                    showToast(`BINGO: ${p.name}!`, "#ffffff", true);
                }
                confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
            }
        });
    }

    function stopAuto() {
        clearInterval(autoInterval); autoInterval = null; 
        document.getElementById('auto-btn').innerText = "Sorteio Autom√°tico";
    }

    function initGame() {
        const arena = document.getElementById('arena'); arena.innerHTML = ""; players = [];
        let nomes = [...nomesComuns].sort(() => Math.random() - 0.5);
        for(let i=1; i<=10; i++) {
            let n = []; while(n.length < 24) { let r = Math.floor(Math.random() * 75) + 1; if(!n.includes(r)) n.push(r); } n.splice(12, 0, 0);
            let p = { id: i, name: i === 1 ? "VOC√ä" : nomes[i-2], nums: n, marks: 1 };
            players.push(p);
            let card = document.createElement('div'); card.className = `bingo-card ${i===1?'player':''}`;
            card.innerHTML = `
                <div style="display:flex; justify-content:space-between; align-items:center; padding:0 5px; margin-bottom:5px;">
                    <h5 style="margin:0;">${p.name}</h5>
                    <span id="count-p${i}" style="font-size:0.75rem; color:var(--accent); font-weight:bold;">(1/25)</span>
                </div>
                <div class="grid" id="g-${i}"></div>`;
            arena.appendChild(card);
            p.nums.forEach((num, idx) => {
                let cell = document.createElement('div');
                cell.className = 'cell' + (num === 0 ? ' marked free' : '');
                cell.innerText = num === 0 ? '‚òÖ' : num;
                cell.id = `p${i}-c${idx}`;
                if(num !== 0) cell.setAttribute('data-num', num);
                document.getElementById(`g-${i}`).appendChild(cell);
            });
        }
        updateRanking();
    }

    document.getElementById('btn-unlock').onclick = () => {
        unlockAudio();
        const input = document.getElementById('pass-input').value;
        if (!savedPass) {
            if(input.length === 8) { localStorage.setItem('bingo_vault_pass', input); login(); } 
            else { alert("O PIN deve ter 8 n√∫meros."); }
        } else {
            if (input === savedPass) { login(); } 
            else { alert("PIN Incorreto!"); }
        }
    };

    function login() {
        sessionStorage.setItem('bingo_authenticated', 'true');
        document.getElementById('auth-overlay').style.display = 'none';
        totalBalance = parseFloat(localStorage.getItem('bingo_arena_balance')) || 50.00;
        updateBalanceDisplay(); initGame();
    }

    document.getElementById('draw-btn').onclick = drawBall;
    document.getElementById('auto-btn').onclick = function() {
        unlockAudio();
        if (autoInterval) stopAuto();
        else { this.innerText = "PAUSAR"; autoInterval = setInterval(drawBall, 800); }
    };

    document.getElementById('new-round-btn').onclick = () => {
        if (confirm("Deseja iniciar nova rodada por R$ 6,00?")) location.reload();
    };

    window.addFunds = (val) => {
        unlockAudio(); totalBalance += val;
        saveTransaction("Dep√≥sito PIX", val); updateBalanceDisplay();
        document.getElementById('deposit-modal').style.display = 'none';
        showToast(`+R$ ${val} Adicionados!`, "#2ecc71");
    };

    document.getElementById('open-dep').onclick = () => document.getElementById('deposit-modal').style.display = 'flex';
    document.getElementById('close-dep').onclick = () => document.getElementById('deposit-modal').style.display = 'none';
    document.getElementById('open-wd').onclick = () => {
        document.getElementById('withdraw-modal').style.display = 'flex';
        document.getElementById('wd-balance').innerText = `Saldo dispon√≠vel: R$ ${totalBalance.toFixed(2)}`;
    };
    document.getElementById('close-wd').onclick = () => document.getElementById('withdraw-modal').style.display = 'none';
    
    document.getElementById('confirm-wd').onclick = () => {
        const val = parseFloat(document.getElementById('withdraw-amount').value);
        if(val >= 20 && totalBalance >= val) {
            totalBalance -= val; saveTransaction("Saque PIX", -val);
            updateBalanceDisplay(); alert("Saque solicitado!");
            document.getElementById('withdraw-modal').style.display = 'none';
        } else { alert("Valor m√≠nimo R$ 20."); }
    };

    document.getElementById('open-history-trigger').onclick = () => {
        const list = document.getElementById('wallet-history-list');
        list.innerHTML = walletHistory.length === 0 ? '<p style="text-align:center">Sem movimenta√ß√µes.</p>' : '';
        walletHistory.forEach(item => {
            const isPos = item.value > 0;
            list.innerHTML += `
                <div class="history-item">
                    <div>
                        <div style="font-weight:bold">${item.desc}</div>
                        <div style="font-size:0.7rem; color:#aaa">${item.date}</div>
                    </div>
                    <div class="${isPos ? 'hist-pos' : 'hist-neg'}">
                        ${isPos ? '+' : ''}R$ ${Math.abs(item.value).toFixed(2).replace('.', ',')}
                    </div>
                </div>`;
        });
        document.getElementById('history-modal').style.display = 'flex';
    };
    document.getElementById('close-history').onclick = () => document.getElementById('history-modal').style.display = 'none';
    document.getElementById('btn-logout').onclick = () => { sessionStorage.removeItem('bingo_authenticated'); location.reload(); };
    
    document.getElementById('toggle-sound').onclick = function() {
        soundEnabled = !soundEnabled;
        localStorage.setItem('bingo_sound_enabled', soundEnabled);
        updateSoundButtonUI();
    };

    document.getElementById('header-ranking').onclick = () => {
        const panel = document.querySelector('.bottom-panel');
        if (panel.classList.contains('minimized')) {
            panel.classList.remove('minimized');
            document.getElementById('ranking-title-text').innerText = "RANKING AO VIVO";
        } else {
            document.getElementById('ranking-body').classList.toggle('ranking-collapsed');
        }
    };

    document.getElementById('toggle-full-panel').onclick = function(e) {
        e.stopPropagation();
        const panel = document.querySelector('.bottom-panel');
        panel.classList.add('minimized');
        document.getElementById('ranking-title-text').innerText = "MENU OCULTO (CLIQUE PARA VOLTAR)";
    };

    if (sessionStorage.getItem('bingo_authenticated') === 'true') login();
})();
</script>
</body>
</html>
