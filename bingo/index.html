<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Bingo Arena - Layout Fixo</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        :root { --primary: #e94560; --bg: #1a1a2e; --card-bg: #16213e; --win: #2ecc71; --accent: #f1c40f; }
        * { box-sizing: border-box; }
        
        body { 
            font-family: 'Segoe UI', system-ui, sans-serif; 
            background: var(--bg); 
            color: white; 
            margin: 0; 
            height: 100vh; 
            overflow: hidden; 
            display: flex; 
            flex-direction: column; 
            padding: 10px;
        }

        /* Topo */
        .header { height: 6vh; display: flex; align-items: center; justify-content: center; }
        .msg-banner { font-size: 1.3rem; font-weight: 900; color: var(--win); text-transform: uppercase; text-align: center; }

        /* Dashboard Principal */
        .main-layout { 
            display: grid; 
            grid-template-columns: 220px 1fr 200px; 
            gap: 12px; 
            height: 90vh; 
        }

        .panel { 
            background: var(--card-bg); 
            border-radius: 12px; 
            padding: 12px; 
            display: flex; 
            flex-direction: column; 
            border: 1px solid #333;
            max-height: 100%; /* Garante que o painel não cresça além da viewport */
        }

        /* Sorteador e Histórico (O Ajuste Principal) */
        #ball { font-size: 3.5rem; color: var(--accent); text-align: center; margin: 5px 0; font-weight: 900; }
        
        .history-container {
            flex-grow: 1;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            margin-top: 10px;
            border-top: 1px solid #333;
        }

        .history-grid { 
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 5px;
            overflow-y: auto; 
            padding: 10px 5px;
            background: #0f3460; 
            border-radius: 8px;
        }

        .history-item {
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            font-size: 0.75rem;
            text-align: center;
            padding: 4px 0;
            border: 1px solid rgba(255,255,255,0.05);
        }

        /* Arena Central */
        .arena { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            grid-template-rows: repeat(2, 1fr); 
            gap: 8px; 
        }

        .bingo-card { 
            background: var(--card-bg); 
            padding: 8px; 
            border-radius: 10px; 
            border: 1px solid #333; 
            display: flex; 
            flex-direction: column;
        }
        .bingo-card.player { border: 2px solid var(--primary); box-shadow: 0 0 10px rgba(233, 69, 96, 0.2); }
        .bingo-card h5 { margin: 0 0 5px 0; font-size: 0.75rem; text-align: center; color: #aaa; }

        .grid { 
            display: grid; 
            grid-template-columns: repeat(5, 1fr); 
            gap: 3px; 
            flex-grow: 1;
        }
        .cell { 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            background: #0f3460; 
            border-radius: 3px; 
            font-size: 0.85rem; 
            font-weight: bold; 
            aspect-ratio: 1/1;
        }
        
        .cell.marked { background: var(--primary); }
        .cell.line-win { background: var(--win) !important; color: #1a1a2e; }
        .cell.free { background: #533483; color: var(--accent); }

        /* Ranking */
        .leader-item { display: flex; justify-content: space-between; padding: 4px; border-bottom: 1px solid #0f3460; font-size: 0.75rem; }
        .leader-item.me { color: var(--primary); font-weight: bold; }

        button { 
            padding: 10px; 
            background: var(--primary); 
            color: white; 
            border: none; 
            border-radius: 6px; 
            font-weight: bold; 
            cursor: pointer; 
            font-size: 0.9rem;
        }
        button:disabled { background: #444; }
    </style>
</head>
<body>

    <div class="header">
        <div class="msg-banner" id="game-msg">BINGO ARENA</div>
    </div>

    <div class="main-layout">
        <div class="panel">
            <h3 style="margin:0; font-size: 0.9rem; text-align: center;">SORTEIO</h3>
            <span id="ball">--</span>
            <button id="draw-btn" onclick="drawBall()">SORTEAR</button>
            <div class="history-container">
                <p style="font-size: 0.7rem; text-align: center; margin: 5px 0;">HISTÓRICO</p>
                <div class="history-grid" id="history-grid"></div>
            </div>
        </div>

        <div class="arena" id="arena"></div>

        <div class="panel">
            <h3 style="margin:0; font-size: 0.9rem; text-align: center;">RANKING</h3>
            <div id="leader-list" style="margin-top: 10px;"></div>
            <button style="margin-top: auto; background: #533483;" onclick="location.reload()">REINICIAR</button>
        </div>
    </div>

<script>
    let drawn = [];
    let players = [];
    let firstLineOut = false;
    let gameOver = false;

    function genNums() {
        let n = [];
        while(n.length < 24) {
            let r = Math.floor(Math.random() * 75) + 1;
            if(!n.includes(r)) n.push(r);
        }
        n.splice(12, 0, 0); 
        return n;
    }

    function init() {
        for(let i=1; i<=6; i++) {
            let p = { id: i, name: i===1?"VOCÊ":`JOG. 0${i}`, nums: genNums(), marks: 1 };
            players.push(p);
            let card = document.createElement('div');
            card.className = `bingo-card ${i===1?'player':''}`;
            card.innerHTML = `<h5>${p.name}</h5><div class="grid" id="g-${i}"></div>`;
            document.getElementById('arena').appendChild(card);
            
            p.nums.forEach((num, idx) => {
                let cell = document.createElement('div');
                cell.className = 'cell' + (num === 0 ? ' marked free' : '');
                cell.innerText = num === 0 ? '★' : num;
                cell.id = `p${i}-c${idx}`;
                if(num !== 0) cell.setAttribute('data-num', num);
                document.getElementById(`g-${i}`).appendChild(cell);
            });
        }
        updateRank();
    }

    function drawBall() {
        if(gameOver || drawn.length >= 75) return;
        let b;
        do { b = Math.floor(Math.random() * 75) + 1; } while(drawn.includes(b));
        drawn.push(b);
        document.getElementById('ball').innerText = b;
        
        // Histórico em Grade
        let h = document.createElement('div');
        h.className = 'history-item';
        h.innerText = b;
        const grid = document.getElementById('history-grid');
        grid.prepend(h);

        document.querySelectorAll(`[data-num="${b}"]`).forEach(c => c.classList.add('marked'));
        players.forEach(p => { if(p.nums.includes(b)) p.marks++; });
        updateRank();
        check();
    }

    function check() {
        players.forEach(p => {
            if(!firstLineOut) {
                for(let r=0; r<5; r++) {
                    let win = true, idxs = [];
                    for(let c=0; c<5; c++) {
                        let i = r*5+c; idxs.push(i);
                        if(!document.getElementById(`p${p.id}-c${i}`).classList.contains('marked')) win = false;
                    }
                    if(win) {
                        firstLineOut = true;
                        document.getElementById('game-msg').innerText = `LINHA: ${p.name}!`;
                        idxs.forEach(idx => document.getElementById(`p${p.id}-c${idx}`).classList.add('line-win'));
                        confetti({ particleCount: 50, origin: {y: 0.8} });
                    }
                }
            }
            if(p.marks === 25) {
                gameOver = true;
                document.getElementById('game-msg').innerText = `BINGO: ${p.name}!`;
                document.getElementById('draw-btn').disabled = true;
                confetti({ particleCount: 200, spread: 100, origin: {y: 0.5} });
            }
        });
    }

    function updateRank() {
        let sorted = [...players].sort((a,b) => b.marks - a.marks);
        let list = document.getElementById('leader-list');
        list.innerHTML = "";
        sorted.forEach(p => {
            list.innerHTML += `<div class="leader-item ${p.id===1?'me':''}"><span>${p.name}</span><span>${p.marks}/25</span></div>`;
        });
    }

    init();
</script>
</body>
</html>
