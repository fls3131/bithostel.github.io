<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bingo Arena Mobile</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        :root { 
            --primary: #e94560; 
            --bg: #1a1a2e; 
            --card-bg: #16213e; 
            --win: #2ecc71; 
            --accent: #f1c40f; 
            --money: #27ae60; 
            --loss: #ff4757; 
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            font-family: 'Segoe UI', sans-serif; 
            background: var(--bg); 
            color: white; 
            margin: 0; 
            height: 100vh; 
            display: flex; 
            flex-direction: column; 
            overflow: hidden;
        }

        /* Modais e Overlays */
        #auth-overlay, #withdraw-modal, #deposit-modal { 
            position: fixed; top:0; left:0; width: 100%; height: 100%; 
            background: rgba(26, 26, 46, 0.98); z-index: 9999; 
            display: flex; align-items: center; justify-content: center; padding: 20px;
        }
        #withdraw-modal, #deposit-modal { display: none; background: rgba(0,0,0,0.9); }

        .auth-card { 
            background: var(--card-bg); padding: 30px 20px; border-radius: 20px; 
            border: 2px solid var(--primary); text-align: center; width: 100%; max-width: 400px; 
        }

        /* AJUSTE: Barra Superior Responsiva */
        header {
            padding: 10px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            background: rgba(0,0,0,0.5);
            min-height: 80px; /* Altura mínima garantida */
            border-bottom: 1px solid var(--primary);
        }

        .stat-card {
            background: #0f3460;
            padding: 8px;
            border-radius: 12px;
            text-align: center;
            border-bottom: 3px solid var(--accent);
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start; /* Inicia do topo para scroll */
            padding: 15px 10px;
            overflow-y: auto;
        }

        /* Cartela Mobile */
        .bingo-card.player {
            width: 100%;
            max-width: 380px;
            background: var(--card-bg);
            padding: 12px;
            border-radius: 15px;
            border: 2px solid var(--primary);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .grid { 
            display: grid; 
            grid-template-columns: repeat(5, 1fr); 
            gap: 4px; 
        }

        .cell { 
            aspect-ratio: 1/1; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            background: #0f3460; 
            border-radius: 6px; 
            font-size: 1.1rem; 
            font-weight: bold; 
            transition: 0.3s;
        }

        .cell.marked { background: var(--primary); transform: scale(0.95); }
        .cell.line-win { background: var(--win) !important; color: #000 !important; }
        .cell.free { background: #533483; color: var(--accent); }

        /* AJUSTE: Controles Inferiores (Botões maiores) */
        .controls {
            padding: 12px;
            background: #111;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            border-top: 2px solid var(--primary);
            padding-bottom: env(safe-area-inset-bottom); /* Suporte para iPhone X+ */
        }

        button { 
            border: none; border-radius: 12px; font-weight: bold; 
            cursor: pointer; color: white; 
            transition: 0.2s;
            text-transform: uppercase;
            min-height: 50px; /* Altura ideal para toque */
            font-size: 0.9rem;
        }

        .btn-draw { background: var(--primary); font-size: 1.1rem; grid-column: span 1; }
        .btn-auto { background: #3498db; }
        .btn-action { background: #333; padding: 10px; font-size: 0.75rem; }

        /* Ajuste do botão de Nova Rodada para destaque */
        .btn-new-round {
            grid-column: span 2;
            background: #533483;
            height: 55px;
            font-size: 1rem;
            margin-top: 2px;
        }

        #ranking-panel {
            position: fixed;
            right: -280px;
            top: 0;
            width: 280px;
            height: 100%;
            background: var(--card-bg);
            z-index: 10000;
            transition: 0.3s;
            padding: 20px;
            border-left: 3px solid var(--primary);
        }
        #ranking-panel.open { right: 0; }

        .leader-item { 
            display: flex; justify-content: space-between; 
            padding: 12px; border-bottom: 1px solid #0f3460; font-size: 0.95rem; 
        }

        #money-toast { 
            position: fixed; top: 15%; left: 50%; transform: translateX(-50%); 
            z-index: 10000; font-size: 1.8rem; font-weight: 900; pointer-events: none; 
            opacity: 0; transition: 0.4s; text-align: center; width: 90%;
            text-shadow: 0 0 10px rgba(0,0,0,0.5);
        }
        .toast-show { opacity: 1 !important; transform: translate(-50%, -10px) scale(1.1) !important; }
        
        .auth-input { 
            background: #0f3460; border: 2px solid var(--primary); color: white; 
            padding: 15px; font-size: 1.8rem; width: 100%; text-align: center; 
            margin: 15px 0; border-radius: 12px; 
        }
    </style>
</head>
<body>

    <div id="money-toast"></div>

    <div id="deposit-modal">
        <div class="auth-card">
            <h2 style="color: #3498db;">DEPOSITAR PIX</h2>
            <div style="display: grid; grid-template-columns: 1fr; gap: 10px; margin-bottom: 15px;">
                <button onclick="addMoney(10)" style="background:#3498db">R$ 10,00</button>
                <button onclick="addMoney(50)" style="background:#3498db">R$ 50,00</button>
                <button onclick="addMoney(100)" style="background:#3498db">R$ 100,00</button>
            </div>
            <button onclick="closeModal('deposit-modal')" style="background:#555; width:100%">VOLTAR</button>
        </div>
    </div>

    <div id="auth-overlay">
        <div class="auth-card">
            <h2 id="auth-title">BINGO ARENA</h2>
            <p id="auth-instruction">Crie um PIN de 4 dígitos</p>
            <input type="password" id="pass-input" class="auth-input" maxlength="4" inputmode="numeric">
            <button id="btn-unlock" style="background: var(--primary); width: 100%; height: 60px; border-radius: 12px;">ENTRAR</button>
        </div>
    </div>

    <header>
        <div class="stat-card">
            <small style="color: var(--accent)">SALDO</small>
            <span id="balance" style="font-weight: 900; font-size: 1.2rem;">R$ 0,00</span>
        </div>
        <div class="stat-card">
            <small style="color: var(--accent)">SORTEADA</small>
            <span id="ball" style="font-weight: 900; font-size: 1.4rem;">--</span>
        </div>
    </header>

    <div class="main-content">
        <div id="player-arena"></div>
        
        <div style="margin-top: 15px; width: 100%; max-width: 380px;">
            <button onclick="toggleRanking()" class="btn-action" style="width: 100%; min-height: 40px;">Ver Ranking da Arena</button>
        </div>
    </div>

    <div id="ranking-panel">
        <button onclick="toggleRanking()" style="background: var(--loss); width: 100%; margin-bottom: 15px;">FECHAR</button>
        <h3>RANKING</h3>
        <div id="leader-list"></div>
    </div>

    <footer class="controls">
        <button id="draw-btn" class="btn-draw">SORTEAR</button>
        <button id="auto-btn" class="btn-auto">AUTO</button>
        <button onclick="location.reload()" class="btn-new-round">NOVA RODADA (R$ 5,00)</button>
        <button onclick="openModal('deposit-modal')" class="btn-action">DEPOSITAR</button>
        <button onclick="logout()" class="btn-action">SAIR</button>
    </footer>

<script>
    // O código JavaScript permanece o mesmo para manter a funcionalidade
    (function() {
        const sounds = {
            draw: new Audio('sorteio.mp3'),
            money: new Audio('dinheiro.mp3'),
            mark: new Audio('marca.mp3'),
            bingo: new Audio('bingo.mp3')
        };

        let drawn = [], players = [], gameOver = false, autoInterval = null;
        let totalBalance = 0;
        const ROUND_COST = 5.0, LINE_PRIZE = 10.0, BINGO_PRIZE = 20.0;

        const savedPass = localStorage.getItem('bingo_vault_pass');
        if(savedPass) {
            document.getElementById('auth-title').innerText = "ACESSO PIN";
            document.getElementById('auth-instruction').innerText = "Insira seu código secreto";
        }

        function updateBalance() {
            document.getElementById('balance').innerText = `R$ ${totalBalance.toFixed(2).replace('.', ',')}`;
            localStorage.setItem('bingo_arena_balance', totalBalance);
        }

        window.addMoney = (val) => {
            totalBalance += val;
            updateBalance();
            sounds.money.play().catch(()=>{});
            closeModal('deposit-modal');
        };

        window.openModal = (id) => document.getElementById(id).style.display = 'flex';
        window.closeModal = (id) => document.getElementById(id).style.display = 'none';
        window.toggleRanking = () => document.getElementById('ranking-panel').classList.toggle('open');
        window.logout = () => { sessionStorage.clear(); location.reload(); };

        function showToast(text, color) {
            const t = document.getElementById('money-toast');
            t.innerText = text; t.style.color = color;
            t.classList.add('toast-show');
            setTimeout(() => t.classList.remove('toast-show'), 2000);
        }

        function initGame() {
            const arena = document.getElementById('player-arena');
            players = [];
            const names = ["JOÃO", "MARIA", "PEDRO", "ANA", "LUCAS", "CARLA", "BRUNO", "JULIA", "MARCOS", "BEATRIZ"];

            for(let i=1; i<=10; i++) {
                let n = []; while(n.length < 24) { let r = Math.floor(Math.random() * 75) + 1; if(!n.includes(r)) n.push(r); } 
                n.splice(12, 0, 0);
                let p = { id: i, name: i === 1 ? "VOCÊ" : names[i-1], nums: n, marks: 1, hasLine: false };
                players.push(p);

                if(i === 1) {
                    let card = document.createElement('div');
                    card.className = "bingo-card player";
                    card.innerHTML = `<h3 style="text-align:center; margin-top:0; font-size: 1rem;">SUA CARTELA</h3><div class="grid" id="p1-grid"></div>`;
                    arena.appendChild(card);
                    
                    p.nums.forEach((num, idx) => {
                        let cell = document.createElement('div');
                        cell.className = 'cell' + (num === 0 ? ' marked free' : '');
                        cell.innerText = num === 0 ? '★' : num;
                        cell.id = `p1-c${idx}`;
                        if(num !== 0) cell.setAttribute('data-num', num);
                        document.getElementById('p1-grid').appendChild(cell);
                    });
                }
            }
        }

        function drawBall() {
            if(gameOver || drawn.length >= 75) return;
            
            let b; do { b = Math.floor(Math.random() * 75) + 1; } while(drawn.includes(b));
            drawn.push(b);
            document.getElementById('ball').innerText = b;

            document.querySelectorAll(`[data-num="${b}"]`).forEach(c => {
                c.classList.add('marked');
                sounds.mark.play().catch(()=>{});
            });

            players.forEach(p => {
                if(p.nums.includes(b)) p.marks++;
                if(!p.hasLine) {
                    for(let r=0; r<5; r++) {
                        let rowWin = true;
                        for(let c=0; c<5; c++) {
                            let idx = r*5+c;
                            let val = p.nums[idx];
                            if(val !== 0 && !drawn.includes(val)) rowWin = false;
                        }
                        if(rowWin) {
                            p.hasLine = true;
                            if(p.id === 1) {
                                totalBalance += LINE_PRIZE;
                                showToast("+ R$ 10,00 (LINHA)", "var(--win)");
                                updateBalance();
                                document.querySelectorAll('#p1-grid .marked').forEach(el => el.classList.add('line-win'));
                            }
                        }
                    }
                }

                if(p.marks === 25 && !gameOver) {
                    gameOver = true;
                    if(autoInterval) clearInterval(autoInterval);
                    if(p.id === 1) {
                        totalBalance += BINGO_PRIZE;
                        showToast("BINGO! + R$ 20,00", "var(--accent)");
                        confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
                    } else {
                        showToast(`BINGO: ${p.name} VENCEU`, "var(--loss)");
                    }
                    updateBalance();
                }
            });
            updateRanking();
        }

        function updateRanking() {
            const list = document.getElementById('leader-list');
            const sorted = [...players].sort((a,b) => b.marks - a.marks);
            list.innerHTML = sorted.map(p => `
                <div class="leader-item" style="${p.id===1?'color:var(--accent); font-weight:bold':''}">
                    <span>${p.name}</span>
                    <span>${p.marks}/25</span>
                </div>
            `).join('');
        }

        document.getElementById('btn-unlock').onclick = () => {
            const val = document.getElementById('pass-input').value;
            if(val.length < 4) return alert("PIN de 4 dígitos");
            if(!savedPass) localStorage.setItem('bingo_vault_pass', val);
            else if(val !== savedPass) return alert("PIN Incorreto");
            sessionStorage.setItem('bingo_auth', 'true');
            document.getElementById('auth-overlay').style.display = 'none';
            totalBalance = parseFloat(localStorage.getItem('bingo_arena_balance')) || 50.0;
            updateBalance();
            initGame();
        };

        document.getElementById('draw-btn').onclick = () => {
            if(totalBalance < ROUND_COST && drawn.length === 0) return alert("Saldo insuficiente");
            if(drawn.length === 0) { totalBalance -= ROUND_COST; updateBalance(); showToast("- R$ 5,00", "var(--loss)"); }
            drawBall();
        };

        document.getElementById('auto-btn').onclick = function() {
            if(autoInterval) {
                clearInterval(autoInterval);
                autoInterval = null;
                this.innerText = "AUTO";
            } else {
                if(totalBalance < ROUND_COST && drawn.length === 0) return alert("Saldo insuficiente");
                if(drawn.length === 0) { totalBalance -= ROUND_COST; updateBalance(); }
                this.innerText = "PARAR";
                autoInterval = setInterval(drawBall, 600);
            }
        };

        if(sessionStorage.getItem('bingo_auth')) {
            document.getElementById('auth-overlay').style.display = 'none';
            totalBalance = parseFloat(localStorage.getItem('bingo_arena_balance')) || 50.0;
            updateBalance();
            initGame();
        }
    })();
</script>
</body>
</html>
